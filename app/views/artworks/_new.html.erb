<div class="artwork-new">
	<p> Vous vous apprêtez à créer une oeuvre qui n'apparaît pas sur la carte. </p>
	<%= form_tag (artworks_path) do %>
	<% if @artwork.errors.any? %>
	<div id="error_explanation">
	  <h2>
	    <%= pluralize(@artwork.errors.count, "error") %> prohibited
	    this user from being saved:
	  </h2>
	    <% @artwork.errors.full_messages.each do |msg| %>
	      <p><%= msg %></p>
	    <% end %>
	</div>
	<% end %>

	<div class="field input" >
	  <%= text_field_tag :title, nil, placeholder: "Nom de l'oeuvre (si vous le connaissez)" %>
	</div>
	<div class="field input">
	  <%= text_field_tag :artist,nil, placeholder: "Nom de l'artiste (si vous le connaissez)" %>
	</div>


	<div id="small-map-index"></div>


	<div class="field input" style="display: none">
	  <%= label_tag 'lat', "Latitude"  %>
	  <%= text_field_tag :lat, id:"lat" %>
	</div>
	<div class="field input" style="display:none">
	  <%= label_tag 'long', "Longitude"  %>
	  <%= text_field_tag :long, id:"long" %>
	</div>
	<%= submit_tag 'Valider', class: "btn btn-primary", id:"submit-artwork"%>
	<% end %>
</div>

<div class="picture-new" style="display: none">
</div>


<script type="text/javascript">


getLocation();

console.log(sessionStorage.getItem('lat') + ", " + sessionStorage.getItem('lng'));

// We start by getting current user location

document.getElementById("lat").value = sessionStorage.getItem('lat');
document.getElementById("long").value = sessionStorage.getItem('lng');


// We set the map where the new point is supposed to be

small_map = L.map('small-map-index').setView([sessionStorage.getItem('lat'), sessionStorage.getItem('lng')], 16)


// This is a public token
L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoianVzdGlrcm8iLCJhIjoiY2plbzR6djJnM3RyOTJ4cGszb3hiNGdtcCJ9._gRBjH1x_-nGrj7hD-2i6g', {
    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',
    maxZoom: 20,
    id: 'mapbox.streets',
    accessToken: 'pk.eyJ1IjoianVzdGlrcm8iLCJhIjoiY2plbzR6djJnM3RyOTJ4cGszb3hiNGdtcCJ9._gRBjH1x_-nGrj7hD-2i6g'
}).addTo(small_map);

var marker = L.marker([sessionStorage.getItem('lat'), sessionStorage.getItem('lng')]).addTo(small_map);


// We put an ajax request under the submit button to open the new-picture form
$("#submit-artwork").on("click", function(){
	$(".artwork-new").hide();
    $.ajax({
        type: "GET",
        contentType: "application/script; charset=utf-8",
        //dataType: "text",
        url: "/pictures/new/"
        //complete: function(content){
    	//	content.then(function(plop){ console.log(plop)})
    	//}
    });

});

// If we click on the map, the form is hidden
$(".background-new-form").on("click", function(){
  $('.leaflet-control-container').show()
  $(".popup-form").hide();

});


</script>
