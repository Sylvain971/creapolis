<header>
    <li><%= link_to content_tag(:i, nil, class: 'fas fa-bars'), root_path %>
    </li>
    <div class="header_title">Creapolis</div>
    <li><%= link_to content_tag(:i, nil, class: 'fas fa-plus'), root_path %>
    </li>
</header>

<% if user_signed_in? %>
<div id="map_index"></div>

<script type="text/javascript">

map = L.map('map_index').setView([ 48.8879012, 2.384519], 17)

L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
  attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
  maxZoom: 18
}).addTo(map)

var arr = <%= @artworks_js.html_safe %>

var markers = {};
console.log(arr)

for (var i=0; i < arr.length; i++){
  var test = arr[i];
  markers[test.id] = L.marker([test.lat,test.long]).addTo(map);
  markers[test.id]._icon.id = test.id;
}

  $('.leaflet-marker-icon').on('click', function(e) {
     // Use the event to find the clicked element
     var el = $(e.srcElement || e.target),
         id = el.attr('id');
        a = arr.find(function(v) {
        return v.id == id;
        }) || {}


        var x = document.getElementById("feature_infos");
        var y = document.getElementById("link_to_artwork")

        $('#info').html("Artiste : " +a.users[0].pseudo);
        $('#link_to_artwork').attr("href", "/artworks/"+id);
     //   $('#image').attr("href", a.pictures[0].img_url);


        if (x.style.display === "none") {
            x.style.display = "block";
        } else {
            x.style.display = "none";
        }
});

</script>

<div id="feature_infos" style="display:none">
  <p id="info"></p>
  <a id="link_to_artwork" href="test">Lien vers la page de l'oeuvre</a>
  <%= image_tag "image1.jpg", width:"150px", id:"image"%>
</div>


<% else %>
<div class="container connection">

  <!-- formulaire pour se connecter -->
  <div class="box_connection_top">
        <H2>Se connecter</h2>
        <%= form_tag new_user_session_path do %>
          <%= text_field_tag 'user[email]', value="Adresse Email" %>
          <%= password_field_tag 'user[password]', value="Mot de passe" %>
          <br>
          <%= check_box_tag 'user[remember_me]'%>
          <%= label_tag 'user[remember_me]', 'Se souvenir de moi' %>
          <br><br>
          <%= submit_tag 'Se connecter'%>
         <% end %>
         <br><br>
         <%= link_to "Mot de passe oublié ?", new_user_password_path %><br/>
  </div>
  <div class="box_connection_bottom">
        <%= link_to "Créer un compte", new_user_registration_path%>
  </div>
  <!-- FIN formulaire pour se connecter -->

</div>
<% end %>
<%= render 'layouts/bottom_menu' %>
